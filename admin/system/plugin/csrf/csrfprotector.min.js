var CSRFP_FIELD_TOKEN_NAME='csrfp_hidden_data_token';var CSRFP_FIELD_URLS='csrfp_hidden_data_urls';var CSRFP={CSRFP_TOKEN:'csrfp_token',checkForUrls:[],_isValidGetRequest:function(url){for(var i=0;i<CSRFP.checkForUrls.length;i++){var match=CSRFP.checkForUrls[i].exec(url);if(match!==null&&match.length>0){return false;}}return true;},_getAuthKey:function(){var re=new RegExp(CSRFP.CSRFP_TOKEN+"=([^;]+)(;|$)");var RegExpArray=re.exec(document.cookie);if(RegExpArray===null){return false;}return RegExpArray[1];},_getDomain:function(url){if(url.indexOf("http://")!==0&&url.indexOf("https://")!==0)return document.domain;return/http(s)?:\/\/([^\/]+)/.exec(url)[2];},_getInputElt:function(){var hiddenObj=document.createElement("input");hiddenObj.name=CSRFP.CSRFP_TOKEN;hiddenObj.type='hidden';hiddenObj.value=CSRFP._getAuthKey();return hiddenObj;},_getAbsolutePath:function(base,relative){var stack=base.split("/");var parts=relative.split("/");stack.pop();for(var i=0;i<parts.length;i++){if(parts[i]==".")continue;if(parts[i]=="..")stack.pop();else
stack.push(parts[i]);}return stack.join("/");},_csrfpWrap:function(fun,obj){return function(event){if(typeof obj[CSRFP.CSRFP_TOKEN]!=='undefined'){var target=obj[CSRFP.CSRFP_TOKEN];target.parentNode.removeChild(target);}var result=fun.apply(this,[event]);obj.appendChild(CSRFP._getInputElt());return result;};},_init:function(){CSRFP.CSRFP_TOKEN=document.getElementById(CSRFP_FIELD_TOKEN_NAME).value;try{CSRFP.checkForUrls=JSON.parse(document.getElementById(CSRFP_FIELD_URLS).value);}catch(err){console.error(err);console.error('[ERROR] [CSRF Protector] unable to parse blacklisted url fields.');}for(var i=0;i<CSRFP.checkForUrls.length;i++){CSRFP.checkForUrls[i]=CSRFP.checkForUrls[i].replace(/\*/g,'(.*)').replace(/\//g,"\\/");CSRFP.checkForUrls[i]=new RegExp(CSRFP.checkForUrls[i]);}}};function csrfprotector_init(){CSRFP._init();for(var i=0;i<document.forms.length;i++){document.forms[i].addEventListener("submit",function(event){if(typeof event.target[CSRFP.CSRFP_TOKEN]==='undefined'){event.target.appendChild(CSRFP._getInputElt());}else{event.target[CSRFP.CSRFP_TOKEN].value=CSRFP._getAuthKey();}});}HTMLFormElement.prototype.addEventListener_=HTMLFormElement.prototype.addEventListener;HTMLFormElement.prototype.addEventListener=function(eventType,fun,bubble){if(eventType==='submit'){var wrapped=CSRFP._csrfpWrap(fun,this);this.addEventListener_(eventType,wrapped,bubble);}else{this.addEventListener_(eventType,fun,bubble);}};if(typeof HTMLFormElement.prototype.attachEvent!=='undefined'){HTMLFormElement.prototype.attachEvent_=HTMLFormElement.prototype.attachEvent;HTMLFormElement.prototype.attachEvent=function(eventType,fun){if(eventType==='submit'){var wrapped=CSRFP._csrfpWrap(fun,this);this.attachEvent_(eventType,wrapped);}else{this.attachEvent_(eventType,fun);}}}function new_open(method,url,async,username,password){this.method=method;var isAbsolute=(url.indexOf("./")===-1)?true:false;if(!isAbsolute){var base=location.protocol+'//'+location.host+location.pathname;url=CSRFP._getAbsolutePath(base,url);}if(method.toLowerCase()==='get'&&!CSRFP._isValidGetRequest(url)){if(url.indexOf('?')===-1){url+="?"+CSRFP.CSRFP_TOKEN+"="+CSRFP._getAuthKey();}else{url+="&"+CSRFP.CSRFP_TOKEN+"="+CSRFP._getAuthKey();}}return this.old_open(method,url,async,username,password);}function new_send(data){if(this.method.toLowerCase()==='post'){if(data!==null&&typeof data==='object'){data.append(CSRFP.CSRFP_TOKEN,CSRFP._getAuthKey());}else{if(typeof data!="undefined"){data+="&";}else{data="";}data+=CSRFP.CSRFP_TOKEN+"="+CSRFP._getAuthKey();}}return this.old_send(data);}if(window.XMLHttpRequest){XMLHttpRequest.prototype.old_send=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.old_open=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=new_open;XMLHttpRequest.prototype.send=new_send;}if(typeof ActiveXObject!=='undefined'){ActiveXObject.prototype.old_send=ActiveXObject.prototype.send;ActiveXObject.prototype.old_open=ActiveXObject.prototype.open;ActiveXObject.prototype.open=new_open;ActiveXObject.prototype.send=new_send;}for(var i=0;i<document.links.length;i++){document.links[i].addEventListener("mousedown",function(event){var href=event.target.href;if(typeof href==="string"){var urlDisect=href.split('#');var url=urlDisect[0];var hash=urlDisect[1];if(CSRFP._getDomain(url).indexOf(document.domain)===-1||CSRFP._isValidGetRequest(url)){return;}if(url.indexOf('?')!==-1){if(url.indexOf(CSRFP.CSRFP_TOKEN)===-1){url+="&"+CSRFP.CSRFP_TOKEN+"="+CSRFP._getAuthKey();}else{url=url.replace(new RegExp(CSRFP.CSRFP_TOKEN+"=.*?(&|$)",'g'),CSRFP.CSRFP_TOKEN+"="+CSRFP._getAuthKey()+"$1");}}else{url+="?"+CSRFP.CSRFP_TOKEN+"="+CSRFP._getAuthKey();}event.target.href=url;if(typeof hash!=='undefined'){event.target.href+='#'+hash;}}});}}document.addEventListener("DOMContentLoaded",function(){csrfprotector_init();});